{"version":3,"file":"PageRecordConfirmEmailChange-B02UHED-.js","sources":["../../src/components/records/PageRecordConfirmEmailChange.svelte"],"sourcesContent":["<script>\n    import PocketBase, { getTokenPayload } from \"pocketbase\";\n    import ApiClient from \"@/utils/ApiClient\";\n    import CommonHelper from \"@/utils/CommonHelper\";\n    import FullPage from \"@/components/base/FullPage.svelte\";\n    import Field from \"@/components/base/Field.svelte\";\n\n    export let params;\n\n    let password = \"\";\n    let isLoading = false;\n    let success = false;\n\n    $: newEmail = CommonHelper.getJWTPayload(params?.token).newEmail || \"\";\n\n    async function submit() {\n        if (isLoading) {\n            return;\n        }\n\n        isLoading = true;\n\n        // init a custom client to avoid interfering with the superuser state\n        const client = new PocketBase(import.meta.env.PB_BACKEND_URL);\n\n        try {\n            const payload = getTokenPayload(params?.token);\n            await client.collection(payload.collectionId).confirmEmailChange(params?.token, password);\n            success = true;\n        } catch (err) {\n            ApiClient.error(err);\n        }\n\n        isLoading = false;\n    }\n</script>\n\n<FullPage nobranding>\n    {#if success}\n        <div class=\"alert alert-success\">\n            <div class=\"icon\"><i class=\"ri-checkbox-circle-line\" /></div>\n            <div class=\"content txt-bold\">\n                <p>Successfully changed the user email address.</p>\n                <p>You can now sign in with your new email address.</p>\n            </div>\n        </div>\n\n        <button type=\"button\" class=\"btn btn-transparent btn-block\" on:click={() => window.close()}>\n            Close\n        </button>\n    {:else}\n        <form on:submit|preventDefault={submit}>\n            <div class=\"content txt-center m-b-base\">\n                <h5>\n                    Type your password to confirm changing your email address\n                    {#if newEmail}\n                        to <strong class=\"txt-nowrap\">{newEmail}</strong>\n                    {/if}\n                </h5>\n            </div>\n\n            <Field class=\"form-field required\" name=\"password\" let:uniqueId>\n                <label for={uniqueId}>Password</label>\n                <!-- svelte-ignore a11y-autofocus -->\n                <input type=\"password\" id={uniqueId} required autofocus bind:value={password} />\n            </Field>\n\n            <button\n                type=\"submit\"\n                class=\"btn btn-lg btn-block\"\n                class:btn-loading={isLoading}\n                disabled={isLoading}\n            >\n                <span class=\"txt\">Confirm new email</span>\n            </button>\n        </form>\n    {/if}\n</FullPage>\n"],"names":["ctx","create_if_block_1","insert","target","form","anchor","append","div","h5","button","span","div2","strong","label","input","params","$$props","password","isLoading","success","submit","$$invalidate","client","PocketBase","payload","getTokenPayload","err","ApiClient","click_handler","newEmail","CommonHelper"],"mappings":"+RAuDyBA,EAAQ,CAAA,GAAAC,EAAAD,CAAA,wMAFd;AAAA,qBAEC,sOAgBMA,EAAS,CAAA,oBADAA,EAAS,CAAA,CAAA,UAK9BE,EAAAC,EAAAC,EAAAC,CAAA,EAvBFC,EAOKF,EAAAG,CAAA,EANDD,EAKIC,EAAAC,CAAA,kDASRF,EAOQF,EAAAK,CAAA,EADJH,EAAyCG,EAAAC,CAAA,4BAtBjBV,EAAM,CAAA,CAAA,CAAA,gBAIrBA,EAAQ,CAAA,0IAgBPA,EAAS,CAAA,gCADAA,EAAS,CAAA,CAAA,ihBAzB/BE,EAAAC,EAAAQ,EAAAN,CAAA,WAIGH,EAAAC,EAAAM,EAAAJ,CAAA,wHAMiB,KACN,oBAA4BL,EAAQ,CAAA,CAAA,6CAASE,EAAAC,EAAAS,EAAAP,CAAA,0BAAjBL,EAAQ,CAAA,CAAA,uFAMzB,UAAQ,iCAAlBA,EAAQ,CAAA,CAAA,oCAEOA,EAAQ,CAAA,CAAA,uCAFEE,EAAAC,EAAAU,EAAAR,CAAA,kBAE0CH,EAAAC,EAAAW,EAAAT,CAAA,MAAXL,EAAQ,CAAA,CAAA,gEAFhEA,EAAQ,CAAA,+BAEOA,EAAQ,CAAA,+BAAiCA,EAAQ,CAAA,OAARA,EAAQ,CAAA,CAAA,2GA1BnFA,EAAO,CAAA,EAAA,imBA/BD,OAAAe,GAAMC,EAEbC,EAAW,GACXC,EAAY,GACZC,EAAU,kBAICC,GAAM,IACbF,SAIJG,EAAA,EAAAH,EAAY,EAAI,EAGV,MAAAI,EAAM,IAAOC,EAAW,KAA8B,MAGlD,MAAAC,EAAUC,EAAgBV,GAAA,YAAAA,EAAQ,KAAK,EACvC,MAAAO,EAAO,WAAWE,EAAQ,YAAY,EAAE,mBAAmBT,GAAA,YAAAA,EAAQ,MAAOE,CAAQ,EACxFI,EAAA,EAAAF,EAAU,EAAI,QACTO,EAAG,CACRC,EAAU,MAAMD,CAAG,CAAA,CAGvBL,EAAA,EAAAH,EAAY,EAAK,CAAA,CAc2D,MAAAU,EAAA,IAAA,OAAO,MAAK,eAiBZX,EAAQ,KAAA,+FAnDrFI,EAAA,EAAAQ,EAAWC,EAAa,cAAcf,GAAA,YAAAA,EAAQ,KAAK,EAAE,UAAY,EAAE"}