{"version":3,"file":"PageRecordConfirmPasswordReset-CFIF8orH.js","sources":["../../src/components/records/PageRecordConfirmPasswordReset.svelte"],"sourcesContent":["<script>\n    import PocketBase, { getTokenPayload } from \"pocketbase\";\n    import ApiClient from \"@/utils/ApiClient\";\n    import CommonHelper from \"@/utils/CommonHelper\";\n    import FullPage from \"@/components/base/FullPage.svelte\";\n    import Field from \"@/components/base/Field.svelte\";\n\n    export let params;\n\n    let newPassword = \"\";\n    let newPasswordConfirm = \"\";\n    let isLoading = false;\n    let success = false;\n\n    $: email = CommonHelper.getJWTPayload(params?.token).email || \"\";\n\n    async function submit() {\n        if (isLoading) {\n            return;\n        }\n\n        isLoading = true;\n\n        // init a custom client to avoid interfering with the superuser state\n        const client = new PocketBase(import.meta.env.PB_BACKEND_URL);\n\n        try {\n            const payload = getTokenPayload(params?.token);\n            await client\n                .collection(payload.collectionId)\n                .confirmPasswordReset(params?.token, newPassword, newPasswordConfirm);\n            success = true;\n        } catch (err) {\n            ApiClient.error(err);\n        }\n\n        isLoading = false;\n    }\n</script>\n\n<FullPage nobranding>\n    {#if success}\n        <div class=\"alert alert-success\">\n            <div class=\"icon\"><i class=\"ri-checkbox-circle-line\" /></div>\n            <div class=\"content txt-bold\">\n                <p>Successfully changed the user password.</p>\n                <p>You can now sign in with your new password.</p>\n            </div>\n        </div>\n\n        <button type=\"button\" class=\"btn btn-transparent btn-block\" on:click={() => window.close()}>\n            Close\n        </button>\n    {:else}\n        <form on:submit|preventDefault={submit}>\n            <div class=\"content txt-center m-b-base\">\n                <h5>\n                    Reset your user password\n                    {#if email}\n                        for <strong>{email}</strong>\n                    {/if}\n                </h5>\n            </div>\n\n            <Field class=\"form-field required\" name=\"password\" let:uniqueId>\n                <label for={uniqueId}>New password</label>\n                <!-- svelte-ignore a11y-autofocus -->\n                <input type=\"password\" id={uniqueId} required autofocus bind:value={newPassword} />\n            </Field>\n\n            <Field class=\"form-field required\" name=\"passwordConfirm\" let:uniqueId>\n                <label for={uniqueId}>New password confirm</label>\n                <input type=\"password\" id={uniqueId} required bind:value={newPasswordConfirm} />\n            </Field>\n\n            <button\n                type=\"submit\"\n                class=\"btn btn-lg btn-block\"\n                class:btn-loading={isLoading}\n                disabled={isLoading}\n            >\n                <span class=\"txt\">Set new password</span>\n            </button>\n        </form>\n    {/if}\n</FullPage>\n"],"names":["ctx","create_if_block_1","insert","target","form","anchor","append","div","h5","button","span","div2","strong","label","input","params","$$props","newPassword","newPasswordConfirm","isLoading","success","submit","$$invalidate","client","PocketBase","payload","getTokenPayload","err","ApiClient","click_handler","email","CommonHelper"],"mappings":"mSA0DyBA,EAAK,CAAA,GAAAC,EAAAD,CAAA,yWAFX;AAAA,qBAEC,4PAqBMA,EAAS,CAAA,oBADAA,EAAS,CAAA,CAAA,UAK9BE,EAAAC,EAAAC,EAAAC,CAAA,EA5BFC,EAOKF,EAAAG,CAAA,EANDD,EAKIC,EAAAC,CAAA,qEAcRF,EAOQF,EAAAK,CAAA,EADJH,EAAwCG,EAAAC,CAAA,4BA3BhBV,EAAM,CAAA,CAAA,CAAA,gBAIrBA,EAAK,CAAA,oMAqBJA,EAAS,CAAA,gCADAA,EAAS,CAAA,CAAA,kjBA9B/BE,EAAAC,EAAAQ,EAAAN,CAAA,WAIGH,EAAAC,EAAAM,EAAAJ,CAAA,wHAMc,MACF,oBAASL,EAAK,CAAA,CAAA,mBAASE,EAAAC,EAAAS,EAAAP,CAAA,2BAAdL,EAAK,CAAA,CAAA,uFAMJ,cAAY,iCAAtBA,EAAQ,EAAA,CAAA,oCAEOA,EAAQ,EAAA,CAAA,uCAFME,EAAAC,EAAAU,EAAAR,CAAA,kBAEyCH,EAAAC,EAAAW,EAAAT,CAAA,MAAdL,EAAW,CAAA,CAAA,iEAFnEA,EAAQ,EAAA,gCAEOA,EAAQ,EAAA,+BAAiCA,EAAW,CAAA,OAAXA,EAAW,CAAA,CAAA,sGAIzD,sBAAoB,iCAA9BA,EAAQ,EAAA,CAAA,oCACOA,EAAQ,EAAA,CAAA,wBADcE,EAAAC,EAAAU,EAAAR,CAAA,kBAC8BH,EAAAC,EAAAW,EAAAT,CAAA,MAArBL,EAAkB,CAAA,CAAA,uDADhEA,EAAQ,EAAA,gCACOA,EAAQ,EAAA,+BAAuBA,EAAkB,CAAA,OAAlBA,EAAkB,CAAA,CAAA,4GA/BnFA,EAAO,CAAA,EAAA,qmBAlCD,OAAAe,GAAMC,EAEbC,EAAc,GACdC,EAAqB,GACrBC,EAAY,GACZC,EAAU,kBAICC,GAAM,IACbF,SAIJG,EAAA,EAAAH,EAAY,EAAI,EAGV,MAAAI,EAAM,IAAOC,EAAW,KAA8B,MAGlD,MAAAC,EAAUC,EAAgBX,GAAA,YAAAA,EAAQ,KAAK,EACvC,MAAAQ,EACD,WAAWE,EAAQ,YAAY,EAC/B,qBAAqBV,GAAA,YAAAA,EAAQ,MAAOE,EAAaC,CAAkB,EACxEI,EAAA,EAAAF,EAAU,EAAI,QACTO,EAAG,CACRC,EAAU,MAAMD,CAAG,CAAA,CAGvBL,EAAA,EAAAH,EAAY,EAAK,CAAA,CAc2D,MAAAU,EAAA,IAAA,OAAO,MAAK,eAiBZZ,EAAW,KAAA,0BAKrBC,EAAkB,KAAA,+FA1DrFI,EAAA,EAAAQ,EAAQC,EAAa,cAAchB,GAAA,YAAAA,EAAQ,KAAK,EAAE,OAAS,EAAE"}