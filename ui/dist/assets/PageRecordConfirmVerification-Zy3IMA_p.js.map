{"version":3,"file":"PageRecordConfirmVerification-Zy3IMA_p.js","sources":["../../src/components/records/PageRecordConfirmVerification.svelte"],"sourcesContent":["<script>\n    import FullPage from \"@/components/base/FullPage.svelte\";\n    import ApiClient from \"@/utils/ApiClient\";\n    import PocketBase, { getTokenPayload, isTokenExpired } from \"pocketbase\";\n\n    export let params;\n\n    let successConfirm = false;\n    let isConfirming = false;\n\n    let successResend = false;\n    let isResending = false;\n\n    send();\n\n    async function send() {\n        if (isConfirming) {\n            return;\n        }\n\n        isConfirming = true;\n\n        // init a custom client to avoid interfering with the superuser state\n        const client = new PocketBase(import.meta.env.PB_BACKEND_URL);\n\n        try {\n            const payload = getTokenPayload(params?.token);\n            await client.collection(payload.collectionId).confirmVerification(params?.token);\n            successConfirm = true;\n        } catch (err) {\n            successConfirm = false;\n        }\n\n        isConfirming = false;\n    }\n\n    $: canResend = params?.token && isTokenExpired(params.token);\n\n    async function resend() {\n        const payload = getTokenPayload(params?.token);\n\n        if (isResending || !payload.collectionId || !payload.email) {\n            return;\n        }\n\n        isResending = true;\n\n        // init a custom client to avoid interfering with the superuser state\n        const client = new PocketBase(import.meta.env.PB_BACKEND_URL);\n\n        try {\n            const payload = getTokenPayload(params?.token);\n            await client.collection(payload.collectionId).requestVerification(payload.email);\n            successResend = true;\n        } catch (err) {\n            ApiClient.error(err);\n            successResend = false;\n        }\n\n        isResending = false;\n    }\n</script>\n\n<FullPage nobranding>\n    {#if isConfirming}\n        <div class=\"txt-center\">\n            <div class=\"loader loader-lg\">\n                <em>Please wait...</em>\n            </div>\n        </div>\n    {:else if successConfirm}\n        <div class=\"alert alert-success\">\n            <div class=\"icon\"><i class=\"ri-checkbox-circle-line\" /></div>\n            <div class=\"content txt-bold\">\n                <p>Successfully verified email address.</p>\n            </div>\n        </div>\n\n        <button type=\"button\" class=\"btn btn-transparent btn-block\" on:click={() => window.close()}>\n            Close\n        </button>\n    {:else if successResend}\n        <div class=\"alert alert-success\">\n            <div class=\"icon\"><i class=\"ri-checkbox-circle-line\" /></div>\n            <div class=\"content txt-bold\">\n                <p>Please check your email for the new verification link.</p>\n            </div>\n        </div>\n\n        <button type=\"button\" class=\"btn btn-transparent btn-block\" on:click={() => window.close()}>\n            Close\n        </button>\n    {:else}\n        <div class=\"alert alert-danger\">\n            <div class=\"icon\"><i class=\"ri-error-warning-line\" /></div>\n            <div class=\"content txt-bold\">\n                <p>Invalid or expired verification token.</p>\n            </div>\n        </div>\n\n        {#if canResend}\n            <button\n                type=\"button\"\n                class=\"btn btn-transparent btn-block\"\n                class:btn-loading={isResending}\n                disabled={isResending}\n                on:click={resend}\n            >\n                <span class=\"txt\">Resend</span>\n            </button>\n        {:else}\n            <button type=\"button\" class=\"btn btn-transparent btn-block\" on:click={() => window.close()}>\n                Close\n            </button>\n        {/if}\n    {/if}\n</FullPage>\n"],"names":["ctx","create_if_block_3","insert","target","div2","anchor","button","div1","append","span","create_if_block","create_if_block_1","create_if_block_2","params","$$props","successConfirm","isConfirming","successResend","isResending","send","$$invalidate","client","PocketBase","payload","getTokenPayload","resend","err","ApiClient","click_handler","click_handler_1","click_handler_2","canResend","isTokenExpired"],"mappings":"uOAoGaA,EAAS,CAAA,EAAAC,sQAFTC,EAAAC,EAAAC,EAAAC,CAAA,ygBAXAH,EAAAC,EAAAC,EAAAC,CAAA,WAIGH,EAAAC,EAAAG,EAAAD,CAAA,gbAfHH,EAAAC,EAAAC,EAAAC,CAAA,WAIGH,EAAAC,EAAAG,EAAAD,CAAA,+NAXHH,EAAAC,EAAAI,EAAAF,CAAA,uKA4COH,EAAAC,EAAAG,EAAAD,CAAA,mPARML,EAAW,CAAA,oBADFA,EAAW,CAAA,CAAA,UAK1BE,EAAAC,EAAAG,EAAAD,CAAA,EADJG,EAA8BF,EAAAG,CAAA,oBAFpBT,EAAM,CAAA,CAAA,iCADNA,EAAW,CAAA,0BADFA,EAAW,CAAA,CAAA,sEAxCrCA,EAAY,CAAA,EAAAU,EAMPV,EAAc,CAAA,EAAAW,EAWdX,EAAa,CAAA,EAAAY,0eA5EZ,OAAAC,GAAMC,EAEbC,EAAiB,GACjBC,EAAe,GAEfC,EAAgB,GAChBC,EAAc,GAEdC,EAAA,iBAEWA,GAAI,IACXH,SAIJI,EAAA,EAAAJ,EAAe,EAAI,EAGb,MAAAK,EAAM,IAAOC,EAAW,KAA8B,MAGlD,MAAAC,EAAUC,EAAgBX,GAAA,YAAAA,EAAQ,KAAK,QACvCQ,EAAO,WAAWE,EAAQ,YAAY,EAAE,oBAAoBV,GAAA,YAAAA,EAAQ,KAAK,EAC/EO,EAAA,EAAAL,EAAiB,EAAI,OACb,CACRK,EAAA,EAAAL,EAAiB,EAAK,CAAA,CAG1BK,EAAA,EAAAJ,EAAe,EAAK,CAAA,gBAKTS,GAAM,CACX,MAAAF,EAAUC,EAAgBX,GAAA,YAAAA,EAAQ,KAAK,EAEzC,GAAAK,IAAgBK,EAAQ,cAAiB,CAAAA,EAAQ,aAIrDH,EAAA,EAAAF,EAAc,EAAI,EAGZ,MAAAG,EAAM,IAAOC,EAAW,KAA8B,MAGlDC,MAAAA,EAAUC,EAAgBX,GAAA,YAAAA,EAAQ,KAAK,QACvCQ,EAAO,WAAWE,EAAQ,YAAY,EAAE,oBAAoBA,EAAQ,KAAK,EAC/EH,EAAA,EAAAH,EAAgB,EAAI,QACfS,EAAG,CACRC,EAAU,MAAMD,CAAG,EACnBN,EAAA,EAAAH,EAAgB,EAAK,CAAA,CAGzBG,EAAA,EAAAF,EAAc,EAAK,CAAA,CAmByD,MAAAU,EAAA,IAAA,OAAO,MAAK,EAWZC,EAAA,IAAA,OAAO,MAAK,EAsBRC,EAAA,IAAA,OAAO,MAAK,oFA3E/FV,EAAA,EAAEW,GAAYlB,GAAA,YAAAA,EAAQ,QAASmB,EAAenB,EAAO,KAAK,CAAA"}